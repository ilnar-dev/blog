<%- include('header'); %>

<main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-4">
    <div class="container">
        <% if (article.id) { %>
            <h1>Edit article</h1>
            <form action="/admin/articles/<%= article.id %>" method="post" enctype="multipart/form-data">
        <% } else { %>
            <h1>Create article</h1>
            <form action="/admin/articles" method="post" enctype="multipart/form-data">
        <% } %>

            <div class="form-group">
                <label for="title">Post title</label>
                <input class="form-control" type="text" id="title" name="title" value="<%= article.title %>">
            </div>
            <div class="form-group">
                <label for="text">Post text</label>
                <textarea cols="6" class="form-control" type="text" id="text" name="text"><%= article.text %></textarea>
            </div>
            <div id="mainImageGroup" class="form-group">
                <input type="hidden" id="main_image_id" name="main_image_id" value="<%= article.main_image_id%>">
                <% if (article.mainImage) { %>
                    <div id="mainImageView">
                        <div>
                            <span id="deleteMainImage">delete</span>
                        </div>
                        <div>
                            <img id="mainImage" src="/uploads/<%= article.mainImage.filename %>" alt="main image" class="img-thumbnail">
                        </div>
                    </div>
                <% } else { %>
                    <div id="mainImageUpload">
                        <label for="mainImage">Upload new main image</label>
                        <input class="form-control-file" type="file" id="mainImage" name="mainImage">
                    </div>
                <% } %>
            </div>
            <div class="form-group">
                <button type="submit" class="btn btn-primary">Save</button>
            </div>
        </form>
    </div>
</main>
<style>
    .img-thumbnail {
        width: 200px;
    }

    #deleteMainImage {
        color: red;
        text-decoration: underline;
    }

    #deleteMainImage:hover {
        cursor: pointer;
    }
</style>
<script src="/js/ckeditor.js"></script>

<script>
    // gallery edit




    // main image
    let deleteImageButton = document.getElementById("deleteMainImage");
    deleteImageButton.addEventListener("click", function () {
        let mainImageIdInput = document.getElementById("main_image_id");
        mainImageIdInput.value = '';
        let mainImageView = document.getElementById("mainImageView");
        mainImageView.parentNode.removeChild(mainImageView);

        let mainImageUpload = document.createElement("div");

        let labelForMainImage = document.createElement("label");
        labelForMainImage.setAttribute("for", "mainImage");
        mainImageUpload.appendChild(labelForMainImage);

        let mainImageInput = document.createElement("input");
        mainImageInput.setAttribute("class", "form-control-file");
        mainImageInput.setAttribute("type", "file");
        mainImageInput.setAttribute("id", "mainImage");
        mainImageInput.setAttribute("name", "mainImage");

        mainImageUpload.appendChild(mainImageInput);

        let mainImageGroup = document.getElementById("mainImageGroup");
        mainImageGroup.appendChild(mainImageUpload);
    });

    // CKEditor
    ClassicEditor
        .create( document.querySelector( '#text' ), {
            // plugins: [ SimpleUploadAdapter, /* ... */ ],
            // toolbar: [ /* ... */ ],
            simpleUpload: {
                uploadUrl: '/admin/images',
            }
        } )
        .then( /* ... */ )
        .catch( /* ... */ );
</script>
<%- include('footer'); %>
